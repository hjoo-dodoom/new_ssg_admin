<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=1400"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>신세계 관리자</title>
    <!-- CSS files -->
    <link href="/resources/static/dist/css/tabler.css" rel="stylesheet"/>
    <link href="/resources/static/dist/css/tabler-vendors.css" rel="stylesheet"/>
    <link href="/resources/static/dist/css/style.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/spectrum-colorpicker2/dist/spectrum.min.css"/>
    <link rel="shortcut icon" href="/resources/static/dist/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/resources/static/dist/favicon.ico" type="image/x-icon">
    <script src="/resources/static/dist/js/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="/resources/static/dist/libs/litepicker/dist/litepicker.js?1674944402"></script>
    <script src="/resources/static/dist/js/jquery.validate.js"></script>
    <!-- Tabler Core -->
    
    <script src="/resources/static/dist/js/common.js"></script>
    <style>
    :root {
        --theme-admin-type: #cf3f42;
        /* #cf3f42 통합관리자 컬러 코드*/
        /* #4b9b52 협력회사 컬러 코드 */
        /* #214c9c 고객사 컬러 코드 */
    }
    </style>
</head>
<body>

<div class="popup-wrapper">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="card table-mb-card">
                        <div class="table-responsive" style="overflow-y:auto;max-height:300px;">
                            <table class="table table-vcenter table-line card-table text-center table-mb label-control tr_hover">
                                <thead>
                                    <tr>
                                        <th style="min-width:60px;max-width:60px;">번호</th>
                                        <th style="min-width:100px;max-width:100px;">협력회사명</th>
                                        <th style="min-width:130px;max-width:130px;">제목</th>
                                        <th>첨부파일</th>
                                        <th style="min-width:75px;max-width:75px;">파일용량</th>
                                        <th style="min-width:75px;max-width:75px;">수정/삭제</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>20</td>
                                        <td class="text-start">(주)농협홍삼</td>
                                        <td class="text-start">농협홍삼 한삼인 홍삼선물제안서</td>
                                        <td>
                                            <a href="#" download="" class="badge bg-blue-lt m-1">한국투자증권 상반기 vip 시즌_제안서_(주)디오트.ppt</a>
                                            <a href="#" download="" class="badge bg-blue-lt m-1">시즌_제안서_(주)디오트.ppt</a>
                                        </td>
                                        <td>0 KB</td>
                                        <td>
                                            <button class="btn btn-xs btn-primary" type="button">수정</button>
                                            <button class="btn btn-xs btn-warning" type="button">삭제</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="card form_area">
                <div class="card-header"><h3 class="card-title">제안서 첨부</h3></div>
                <div class="card-body">
                    <div class="row">
                        <div class="form_item">
                            <div class="subheader mb-1">내용</div>
                            <div class="subcontent">
                                <div class="input-group">
                                    <input class="form-control max-text" maxlength="60" type="text" name="" placeholder="공지사항 내용을 참고하여 첨부파일에 대한 간략한 내용을 입력해주세요.">
                                    <span class="input-group-text text max-len"><b>0</b>/60자</span>
                                </div>
                            </div>
                        </div>
                        <div class="form_item size_lg">
                            <div class="subheader mb-1">첨부파일</div>
                            <div class="subcontent" id="uploadFiles">

                                <!-- 업로드된 파일이 있는 경우 -->
                                <!-- <div class="input-group">
                                    <input type="file" class="form-control" style="display:none;" onchange="updateFileSize(this);">
                                    <input type="text" class="form-control" value="aaaa.zip" data-file-size="15.4" readonly="">
                                    <button class="btn btn-xs btn-danger" type="button" onclick="removeUploadedFile(this)">기존파일 삭제</button>
                                    <span class="input-group-text text">15.4MB</span>
                                    <button class="btn btn-xs btn-warning" type="button" onclick="removeFile(this)">삭제</button>
                                    <button class="btn btn-xs btn-primary" type="button" onclick="addFile()">추가</button>
                                </div>
                                <div class="input-group">
                                    <input type="file" class="form-control" style="display:none;" onchange="updateFileSize(this);">
                                    <input type="text" class="form-control" value="filename.zip" data-file-size="20" readonly="">
                                    <button class="btn btn-xs btn-danger" type="button" onclick="removeUploadedFile(this)">기존파일 삭제</button>
                                    <span class="input-group-text text">20MB</span>
                                    <button class="btn btn-xs btn-warning" type="button" onclick="removeFile(this)">삭제</button>
                                </div> -->

                                <!-- 업로드된 파일이 없는 경우 -->
                                <div class="input-group">
                                    <input type="file" class="form-control" data-file-size="" onchange="updateFileSize(this);">
                                    <span class="input-group-text text">0 MB</span>
                                    <button class="btn btn-xs btn-warning" type="button" onclick="removeFile(this)">삭제</button>
                                    <button class="btn btn-xs btn-primary" type="button" onclick="addFile()">추가</button>
                                </div>
                            </div>
                            <small class="form-hint text-danger mt-2">※ 제안서 첨부(첨부가능 파일 용량은 40M로 제한됩니다)</small>
                            <script>
                                let fileSizeTotal = 0;
                            
                                function updateFileSize(elm) {
                                    const file = elm.files[0];
                                    if (file) {
                                        const fileSize = file.size / (1024 * 1024); // MB 단위로 변환
                                        elm.setAttribute('data-file-size', fileSize.toFixed(2));
                                        const fileSizeText = `${fileSize.toFixed(2)} MB`;
                                        const inputGroup = elm.closest('.input-group');
                                        const fileSizeSpan = inputGroup.querySelector('.input-group-text');
                                        fileSizeSpan.textContent = fileSizeText;
                                        updateTotalFileSize();
                                    }
                                }
                            
                                function updateTotalFileSize() {
                                    fileSizeTotal = 0;
                                    document.querySelectorAll('#uploadFiles .input-group').forEach(function(item) {
                                        let fileItem;
                                        const inputFile = item.querySelector('input[type="file"]');
                                        const inputText = item.querySelector('input[type="text"]');
                                        if (inputText) {
                                            fileItem = inputText;
                                        } else if (inputFile) {
                                            fileItem = inputFile;
                                        };
                                        const fileSize = parseFloat(fileItem.getAttribute('data-file-size')) || 0;
                                        fileSizeTotal += fileSize;
                                    });
                                    console.log(fileSizeTotal)
                                    if (fileSizeTotal > 40) {
                                        alert('총 파일 용량이 40MB를 초과합니다. 파일을 제거하거나 용량을 줄여주세요.');
                                    }
                                }
                            
                                window.onload = function() {
                                    updateTotalFileSize();
                                };
                            
                                function addFile() {
                                    const uploadFiles = document.getElementById('uploadFiles');
                                    const fileHtml = `
                                        <div class="input-group">
                                            <input type="file" class="form-control" data-file-size="" onchange="updateFileSize(this);">
                                            <span class="input-group-text text">0 MB</span>
                                            <button class="btn btn-xs btn-warning" type="button" onclick="removeFile(this)">삭제</button>
                                        </div>
                                    `;
                                    uploadFiles.insertAdjacentHTML('beforeend', fileHtml);
                                }
                            
                                //업로드 있었던 파일 삭제
                                function removeUploadedFile(button) {
                                    const inputGroup = button.closest('.input-group');
                                    const inputFile = inputGroup.querySelector('input[type="file"]');
                                    const inputUploadedFileName = inputGroup.querySelector('input[type="text"]');
                                    const fileSize = parseFloat(inputUploadedFileName.getAttribute('data-file-size'));
                                    const fileSizeSpan = inputGroup.querySelector('.input-group-text');
                                    fileSizeSpan.textContent = '0MB';
                                    fileSizeTotal -= fileSize;
                                    inputFile.style.display = 'block';
                                    inputUploadedFileName.remove();
                                    button.remove();
                                    updateTotalFileSize();
                                }
                            
                                function removeFile(button) {
                                    const uploadFiles = document.getElementById('uploadFiles');
                                    const inputGroup = button.closest('.input-group');
                                    const inputFile = inputGroup.querySelector('input[type="file"]');
                                    const fileSize = parseFloat(inputFile.getAttribute('data-file-size')) || 0;
                                    const fileSizeSpan = inputGroup.querySelector('.input-group-text');
                                    const inputGroups = Array.from(uploadFiles.children);
                                    const index = inputGroups.indexOf(inputGroup);
                                    if (index === 0) {//첫번째 input이면 삭제 안하고 값만 초기화함.
                                        if(inputGroup.querySelector('input[type="text"]')){
                                            //첫번째 첨부파일이면서 기존파일 업로드가 있는경우 return false
                                            alert(`첫번째 첨부파일의 경우 기존파일 삭제만 가능합니다.`)
                                            return false;
                                        }
                                        inputGroup.querySelector('input').value = '';
                                        fileSizeSpan.textContent = '0MB';
                                    } else {
                                        inputGroup.remove();
                                    }
                                    fileSizeTotal -= fileSize;
                                    updateTotalFileSize();
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
            <div class="list-btns justify-content-between mt-2">
                <div>
                </div>
                <div>
                    <button type="submit" class="btn btn-primary">수정</button>
                    <button type="button" class="btn btn-secondary" onclick="window.close();">닫기</button>
                </div>
            </div>
        </div>
    </div>
</div>

</script>
<script src="/resources/static/dist/js/tabler.min.js"></script>
</body>
</html>