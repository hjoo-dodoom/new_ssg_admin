<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=1400"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>신세계 관리자</title>
    <!-- CSS files -->
    <link href="/resources/static/dist/css/tabler.css" rel="stylesheet"/>
    <link href="/resources/static/dist/css/tabler-vendors.css" rel="stylesheet"/>
    <link href="/resources/static/dist/css/style.css" rel="stylesheet"/>
    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/spectrum-colorpicker2/dist/spectrum.min.css"/> -->
    <link rel="shortcut icon" href="/resources/static/dist/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/resources/static/dist/favicon.ico" type="image/x-icon">
    <script src="/resources/static/dist/js/jquery-3.6.0.min.js"></script>
    <script src="/resources/static/dist/js/jquery-ui.js"></script>
    <script src="/resources/static/dist/libs/litepicker/dist/litepicker.js?1674944402"></script>
    <script src="/resources/static/dist/js/jquery.validate.js"></script>
    <!-- Tabler Core -->
    
    <script src="/resources/static/dist/js/common.js"></script>
    <style>
    :root {
        --theme-admin-type: #cf3f42;
        /* #cf3f42 통합관리자 컬러 코드*/
        /* #4b9b52 협력회사 컬러 코드 */
        /* #214c9c 고객사 컬러 코드 */
    }
    </style>
</head>
<body>

<div class="popup-wrapper">
    <h2 class="popup-title">상품등록</h2>
    <div class="row">
        <div class="col-5">
            <div class="card">
                <div class="card-body">
                    <div class="seasrch_popup">
                        <div class="search_options">
                            <div class="option_item w100">
                                <div class="subheader">협력회사</div>
                                <div class="row">
                                    <div class="col-6">
                                        <select class="form-select">
                                            <option value="" selected="">협력회사명</option>
                                            <option value="" selected="">협력회사아이디</option>
                                        </select>
                                    </div>
                                    <div class="col-6">
                                        <input type="text" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="option_item w100">
                                <div class="subheader">검색</div>
                                <div class="row">
                                    <div class="col-6">
                                        <select class="form-select">
                                            <option value="" selected="">상품명</option>
                                            <option value="" selected="">상품코드</option>
                                        </select>
                                    </div>
                                    <div class="col-6">
                                        <input type="text" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="search_btns">
                            <button type="button" class="btn btn-primary">
                                검색
                            </button>
                            <button type="button" class="btn btn-secondary">
                                검색 초기화
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card-body">
                    <div class="card table-mb-card">
                        <div class="list-btns justify-content-between table_actions">
                            <div>
                                <button type="button" id="addAllBtn" class="btn btn-sm ms-1 btn-outline-secondary" onclick="addAllRows();">전체추가</button>
                                <button type="button" id="addSelectedBtn" class="btn btn-sm ms-1 btn-outline-secondary" onclick="addSelectedRows();">선택추가</button>
                            </div>
                        </div>
                        <div class="table-responsive" style="overflow-y:auto;max-height:calc(100vh - 330px);">
                            <table class="table table-vcenter table-line card-table text-center table-mb label-control tr_hover">
                                <colgroup>
                                    <col style="width:50px;">
                                    <col style="width:80px;">
                                    <col>
                                    <col style="width:110px;">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th class="check-all-box">
                                            <label class="form-check form-check-inline m-0">
                                                <input class="form-check-input check-all" type="checkbox">
                                            </label>
                                        </th>
                                        <th>대표이미지</th>
                                        <th>상품명</th>
                                        <th>판매가</th>
                                    </tr>
                                </thead>
                                <tbody id="leftTableBody">
                                    <tr data-id="111" data-date-time="2024-04-11T11:11" data-modify-date-time="2024-05-11T11:11">
                                        <td>
                                            <label class="form-check form-check-inline m-0">
                                                <input class="form-check-input" type="checkbox">
                                            </label>
                                        </td>
                                        <td>
                                            <img src="/resources/static/dist/img/img.jpg" alt="" class="list_link" style="width:50px;">
                                            <div class="thum_hover">
                                                <img src="/resources/static/dist/img/img.jpg" alt="">
                                            </div>
                                        </td>
                                        <td class="text-start subject">
                                            P0000000001234<br/>
                                            <a href="/resources/static/html/goods/goods_modify.html" class="list_link prd_name">
                                                티비 고라니 거북이 티비 고라니 거북이 티비 고라니 거북이 티비 고라니 거북이 티비 고라니 거북이 티비 고라니 거북이 
                                            </a>
                                        </td>
                                        <td class="price">555,000원</td>
                                    </tr>
                                    <tr data-id="222" data-date-time="2024-05-11T11:11"  data-modify-date-time="2024-03-11T11:11">
                                        <td>
                                            <label class="form-check form-check-inline m-0">
                                                <input class="form-check-input" type="checkbox">
                                            </label>
                                        </td>
                                        <td>
                                            <img src="/resources/static/dist/img/img2.jpg" alt="" class="list_link" style="width:50px;">
                                            <div class="thum_hover">
                                                <img src="/resources/static/dist/img/img2.jpg" alt="">
                                            </div>
                                        </td>
                                        <td class="text-start subject">
                                            P0000000007351<br/>
                                            <a href="/resources/static/html/goods/goods_modify.html" class="list_link prd_name">
                                                [카페]스타벅스 아아 뜨아 샷추 [카페]스타벅스 아아 뜨아 샷추 [카페]스타벅스 아아 뜨아 샷추 [카페]스타벅스 아아 뜨아 샷추 [카페]스타벅스 아아 뜨아 샷추
                                            </a>
                                        </td>
                                        <td class="price">444,000원</td>
                                    </tr>
                                    <tr data-id="333" data-date-time="2024-06-11T11:11" data-modify-date-time="2024-08-11T11:11">
                                        <td>
                                            <label class="form-check form-check-inline m-0">
                                                <input class="form-check-input" type="checkbox">
                                            </label>
                                        </td>
                                        <td>
                                            <img src="/resources/static/dist/img/login_banner3.jpg" alt="" class="list_link" style="width:50px;">
                                            <div class="thum_hover">
                                                <img src="/resources/static/dist/img/login_banner3.jpg" alt="">
                                            </div>
                                        </td>
                                        <td class="text-start subject">
                                            P0000000001122<br/>
                                            <a href="/resources/static/html/goods/goods_modify.html" class="list_link prd_name">
                                                바나나 사과 아몬드 바나나 사과 아몬드 바나나 사과 아몬드 바나나 사과 아몬드 바나나 사과 아몬드 바나나 사과 아몬드 바나나 사과 아몬드 바나나 사과 아몬드
                                            </a>
                                        </td>
                                        <td class="price">123,000원</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="ip_pagenation display-flex justify-content-center mt-4">
                        <div class="pg_btn disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                                <!-- Download SVG icon from http://tabler-icons.io/i/chevron-left -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M11 7l-5 5l5 5"></path>
                                    <path d="M17 7l-5 5l5 5"></path>
                                    </svg>
                            </a>
                        </div>
                        <div class="pg_btn disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                                <!-- Download SVG icon from http://tabler-icons.io/i/chevron-left -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M15 6l-6 6l6 6"></path>
                                </svg>
                            </a>
                        </div>
                        <div class="pg_ip">
                            <input type="tel" value="1" class="form-control"> / 250
                        </div>
                        <div class="pg_btn">
                            <a class="page-link" href="#">
                                <!-- Download SVG icon from http://tabler-icons.io/i/chevron-right -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M9 6l6 6l-6 6"></path>
                                </svg>
                            </a>
                        </div>
                        <div class="pg_btn">
                            <a class="page-link" href="#">
                                <!-- Download SVG icon from http://tabler-icons.io/i/chevron-right -->
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevrons-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M7 7l5 5l-5 5"></path>
                                <path d="M13 7l5 5l-5 5"></path>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-7">
            <div class="radio_taps mb-2">
                <label><input type="radio" name="cate_radio" checked radio-display="cate1"><span>카테고리1<strong class="count text-primary">0</strong></span></label>
                <label><input type="radio" name="cate_radio" radio-display="cate2"><span>카테고리2<strong class="count text-primary">0</strong></span></label>
            </div>
            <div class="card cate1">
                <div class="card-body">
                    <div class="seasrch_popup">
                        <form action="" onsubmit="filterRows(event, this)">
                            <div class="search_options">
                                <div class="option_item w100">
                                    <div class="subheader">상품명,<br/>상품코드</div>
                                    <div class="row">
                                        <div class="col-12">
                                            <input type="text" class="form-control search_input"placeholder="상품명, 상품코드를 입력하면 자동검색 됩니다." oninput="filterRows(event, this);">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="search_btns">
                                <button type="button" class="btn btn-secondary reset_btn" onclick="resetFilter();">
                                    검색 초기화
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="card-body">
                    <div class="card table-mb-card">
                        <div class="list-btns justify-content-between table_actions">
                            <div>
                                <div class="list_count">
                                    <div class="input-group d-inline-flex w-33">
                                        <span class="input-group-text text">선택 항목의 진열순서를</span>
                                        <input type="tel" class="form-control">
                                        <span class="input-group-text text">로</span>
                                        <button type="button" class="btn btn-sm btn-secondary" onclick="indexMoveInput(this);">
                                            변경
                                        </button>
                                    </div>
                                    <span class="ms-1">|</span>
                                    <div class="input-group d-inline-flex w-25">
                                        <input type="tel" class="form-control">
                                        <span class="input-group-text text">%</span>
                                        <button type="button" class="btn btn-sm btn-secondary" onclick="addDiscount(this);">
                                            일괄 추가할인
                                        </button>
                                    </div>
                                    <span class="ms-1">|</span>
                                    <div class="input-group d-inline-flex w-25">
                                        <select name="" id="" class="form-select">
                                            <option value="">정렬선택</option>
                                            <option value="1">신규상품순</option>
                                            <option value="2">최근수정상품순</option>
                                            <option value="3">낮은 가격순</option>
                                            <option value="4">높은 가격순</option>
                                            <option value="5">가나다 순</option>
                                        </select>
                                        <button type="button" class="btn btn-sm btn-secondary" onclick="listSort(this);">
                                            일괄 순서변경
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="list-btns justify-content-between table_actions">
                            <div>
                                <button type="button" id="removeAllBtn" class="btn btn-sm ms-1 btn-outline-secondary" onclick="removeAllRows();">전체삭제</button>
                                <button type="button" id="removeSelectedBtn" class="btn btn-sm ms-1 btn-outline-secondary" onclick="removeSelectedRows();">선택삭제</button>
                            </div>
                        </div>
                        <div class="table-responsive" style="overflow-y:auto;max-height:calc(100vh - 370px);">
                            <table class="table table-vcenter table-line card-table text-center table-mb label-control tr_hover">
                                <colgroup>
                                    <col style="width:60px;">
                                    <col>
                                    <col style="width:60px;">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th class="check-all-box">
                                            <label class="form-check form-check-inline m-0">
                                                <input class="form-check-input check-all" type="checkbox">
                                            </label>
                                        </th>
                                        <th>순서</th>
                                        <th>순서정렬</th>
                                        <th>대표이미지</th>
                                        <th>상품명</th>
                                        <th>판매가</th>
                                        <th>추가할인가</th>
                                        <th>판매기간</th>
                                    </tr>
                                </thead>
                                <tbody class="right_table_body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card cate2">
                <div class="card-body">
                    <div class="seasrch_popup">
                        <form action="" onsubmit="filterRows(event, this)">
                            <div class="search_options">
                                <div class="option_item w100">
                                    <div class="subheader">상품명,<br/>상품코드</div>
                                    <div class="row">
                                        <div class="col-12">
                                            <input type="text" class="form-control search_input"placeholder="상품명, 상품코드를 입력하면 자동검색 됩니다." oninput="filterRows(event, this);">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="search_btns">
                                <button type="button" class="btn btn-secondary reset_btn" onclick="resetFilter();">
                                    검색 초기화
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="card-body">
                    <div class="card table-mb-card">
                        <div class="list-btns justify-content-between table_actions">
                            <div>
                                <div class="list_count">
                                    <div class="input-group d-inline-flex w-33">
                                        <span class="input-group-text text">선택 항목의 진열순서를</span>
                                        <input type="tel" class="form-control">
                                        <span class="input-group-text text">로</span>
                                        <button type="button" class="btn btn-sm btn-secondary" onclick="indexMoveInput(this);">
                                            변경
                                        </button>
                                    </div>
                                    <span class="ms-1">|</span>
                                    <div class="input-group d-inline-flex w-25">
                                        <input type="tel" class="form-control">
                                        <span class="input-group-text text">%</span>
                                        <button type="button" class="btn btn-sm btn-secondary" onclick="addDiscount(this);">
                                            일괄 추가할인
                                        </button>
                                    </div>
                                    <span class="ms-1">|</span>
                                    <div class="input-group d-inline-flex w-25">
                                        <select name="" id="" class="form-select">
                                            <option value="">정렬선택</option>
                                            <option value="1">신규상품순</option>
                                            <option value="2">최근수정상품순</option>
                                            <option value="3">낮은 가격순</option>
                                            <option value="4">높은 가격순</option>
                                            <option value="5">가나다 순</option>
                                        </select>
                                        <button type="button" class="btn btn-sm btn-secondary" onclick="listSort(this);">
                                            일괄 순서변경
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="list-btns justify-content-between table_actions">
                            <div>
                                <button type="button" id="removeAllBtn" class="btn btn-sm ms-1 btn-outline-secondary" onclick="removeAllRows();">전체삭제</button>
                                <button type="button" id="removeSelectedBtn" class="btn btn-sm ms-1 btn-outline-secondary" onclick="removeSelectedRows();">선택삭제</button>
                            </div>
                        </div>
                        <div class="table-responsive" style="overflow-y:auto;max-height:300px;">
                            <table class="table table-vcenter table-line card-table text-center table-mb label-control tr_hover">
                                <colgroup>
                                    <col style="width:60px;">
                                    <col>
                                    <col style="width:60px;">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th class="check-all-box">
                                            <label class="form-check form-check-inline m-0">
                                                <input class="form-check-input check-all" type="checkbox">
                                            </label>
                                        </th>
                                        <th>순서</th>
                                        <th>순서정렬</th>
                                        <th>대표이미지</th>
                                        <th>상품명</th>
                                        <th>판매가</th>
                                        <th>추가할인가</th>
                                        <th>판매기간</th>
                                    </tr>
                                </thead>
                                <tbody class="right_table_body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="list-btns justify-content-between mt-2">
                <div>
                </div>
                <div>
                    <button type="submit" class="btn btn-primary">확정</button>
                    <button type="button" class="btn btn-secondary" onclick="window.close();">닫기</button>
                </div>
            </div>
            
        </div>
    </div>
</div>
<script>
const selectedArrays = {};
let currentCategory = '';

const leftTableBody = document.getElementById('leftTableBody');
const rightTableBodies = {};
const counts = {};
const searchInput = document.querySelectorAll('.search_input');
const resetBtn = document.querySelectorAll('.reset_btn');

// 카테고리 라디오 변경시
document.querySelectorAll('input[name="cate_radio"]').forEach(radio => {
    const category = radio.getAttribute('radio-display');
    selectedArrays[category] = [];
    rightTableBodies[category] = document.querySelector(`.${category} .right_table_body`);
    counts[category] = document.querySelector(`input[radio-display="${category}"] + span .count`);
    
    radio.addEventListener('change', function() {
        currentCategory = this.getAttribute('radio-display');
    });
});

// 초기 카테고리 설정
currentCategory = document.querySelector('input[name="cate_radio"]:checked').getAttribute('radio-display');


// 전체추가
function addAllRows() {
    leftTableBody.querySelectorAll('tr').forEach(row => {
        addRow(row);
    });
    updateIndex();//인덱스 업데이트
    updateDatepicker();//동적생성 데이트픽커 활성화
    updateTimeMask();//동적생성 타임마스트 활성화
    numberFotmatComma();//동적생성 숫자콤마 활성화
    allowOnlyNumbersForTelInputs();//동적생성 input tel 활성화
}

// 선택추가
function addSelectedRows() {
    leftTableBody.querySelectorAll('tr').forEach(row => {
        if (row.querySelector('input[type="checkbox"]').checked) {
            addRow(row);
        }
    });
    updateIndex();//인덱스 업데이트
    updateDatepicker();//동적생성 데이트픽커 활성화
    updateTimeMask();//동적생성 타임마스트 활성화
    numberFotmatComma();//동적생성 숫자콤마 활성화
    allowOnlyNumbersForTelInputs();//동적생성 input tel 활성화
    console.log(selectedArrays)
}

// 전체삭제
function removeAllRows() {
    rightTableBodies[currentCategory].querySelectorAll('tr').forEach(row => {
        removeRow(row);
    });
    console.log(selectedArrays)
}

// 선택삭제
function removeSelectedRows() {
    rightTableBodies[currentCategory].querySelectorAll('tr').forEach(row => {
        if (row.querySelector('input[type="checkbox"]').checked) {
            removeRow(row);
        }
    });
    updateIndex()
}

// 추가함수
function addRow(row) {
    const dataId = row.getAttribute('data-id');
    const dataDateTime = row.getAttribute('data-date-time');
    const dataModifyDateTime = row.getAttribute('data-modify-date-time');

    if (!selectedArrays[currentCategory].includes(dataId)) {
        selectedArrays[currentCategory].push(dataId);
        row.querySelector('input[type="checkbox"]').checked = false;

        const imgUrl = row.querySelector('img').getAttribute('src');
        const dataSubject = row.querySelector('.subject').innerHTML;
        const dataPrice = row.querySelector('.price').innerHTML;
        const clonedrowHtml = `
        <tr data-id="${dataId}" data-date-time="${dataDateTime}" data-modify-date-time="${dataModifyDateTime}">
                <td>
                    <label class="form-check form-check-inline m-0">
                        <input class="form-check-input" type="checkbox">
                    </label>
                </td>
                <td class="index_num"></td>
                <td>
                    <input type="hidden" value="">
                    <button onclick="indexMove(this , 'top')" type="button" class="btn btn-xs my-1 btn-secondary"><span class="icon_chevron top">최상단</span></button>
                    <button onclick="indexMove(this , 'up')" type="button" class="btn btn-xs my-1 btn-secondary"><span class="icon_chevron up">위로</span></button>
                    <button onclick="indexMove(this,'down')" type="button" class="btn btn-xs my-1 btn-secondary"><span class="icon_chevron down">아래로</span></button>
                    <button onclick="indexMove(this,'bottom')" type="button" class="btn btn-xs my-1 btn-secondary"><span class="icon_chevron bottom">최하단</span></button>
                </td>
                <td>
                    <img src="${imgUrl}" alt="" class="list_link" style="width:50px;">
                    <div class="thum_hover">
                        <img src="${imgUrl}" alt="">
                    </div>
                </td>
                <td class="text-start">
                    ${dataSubject}
                </td>
                <td class="price">${dataPrice}</td>
                <td>
                    <div class="input-group">
                        <input type="tel" class="form-control discount"/>
                        <span class="input-group-text text">원</span>
                    </div>
                </td>
                <td>
                    <div class="input-group">
                        <input class="form-control datepicker-icon" placeholder="시작일">
                        <input type="text" name="input-mask" class="form-control input-time" data-mask="00:00" data-mask-visible="true" placeholder="00:00" autocomplete="off">
                    </div>
                    <div class="input-group">
                        <input class="form-control datepicker-icon" placeholder="종료일">
                        <input type="text" name="input-mask" class="form-control input-time" data-mask="00:00" data-mask-visible="true" placeholder="00:00" autocomplete="off">
                    </div>
                </td>
            </tr>
        `;

        row.classList.add('bg_pink');
        row.querySelector('input[type="checkbox"]').disabled = true;

        rightTableBodies[currentCategory].insertAdjacentHTML('beforeend', clonedrowHtml);
        updateSelectedCount();
    }
}

// 삭제함수
function removeRow(row) {
    const dataId = row.getAttribute('data-id');

    const index = selectedArrays[currentCategory].indexOf(dataId);
    if (index > -1) {
        selectedArrays[currentCategory].splice(index, 1);

        const originalRow = leftTableBody.querySelector(`tr[data-id="${dataId}"]`);
        if (originalRow) {
            originalRow.classList.remove('bg_pink');
            originalRow.querySelector('input[type="checkbox"]').disabled = false;
        }

        row.remove();
        updateSelectedCount();
    }
}

// 카운트 업데이트
function updateSelectedCount() {
    Object.keys(counts).forEach(category => {
        counts[category].textContent = selectedArrays[category].length;
    });
}

// 선택상품 검색
function filterRows(event, elm) {
    event.preventDefault();
    const wrap = elm.closest('.card');
    const searchTerm = wrap.querySelector('.search_input').value.toLowerCase();
    const rightTableBody = wrap.querySelector('.right_table_body');
    rightTableBody.querySelectorAll('tr').forEach(row => {
        const customerName = row.cells[4].textContent.toLowerCase();
        if (customerName.includes(searchTerm)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// 선택상품 검색 초기화
function resetFilter() {
    document.querySelectorAll('.search_input').forEach(function(input){
        input.value = '';
    });
    document.querySelectorAll('.right_table_body tr').forEach(function(row){
        row.style.display = '';
    });
}


//순서 변경
function indexMove(button, move) {
    const row = button.closest('tr');
    const table = row.closest('tbody');
    const rows = Array.from(table.querySelectorAll('tr'));
    const index = rows.indexOf(row);

    switch (move) {
        case 'top':
            if (index > 0) {
                table.insertBefore(row, rows[0]);
            }
            break;
        case 'up':
            if (index > 0) {
                table.insertBefore(row, rows[index - 1]);
            }
            break;
        case 'down':
            if (index < rows.length - 1) {
                table.insertBefore(row, rows[index + 2]);
            }
            break;
        case 'bottom':
            if (index < rows.length - 1) {
                table.appendChild(row);
            }
            break;
    }

    // 인덱스 번호 재정렬
    updateIndex()
}

//순서 업데이트
function updateIndex(){
    const categoryTable = document.querySelectorAll('.right_table_body');
    // 인덱스 번호 재정렬
    categoryTable.forEach(function(table){
        let i = 1;
        table.querySelectorAll('.index_num').forEach(function(num){
            num.textContent = i;
            i++
        });
        table.querySelectorAll('input[type="hidden"]').forEach(function(input){
            input.value = i;
            i++
        });
    });
}

//동적으로 생성된 데이트픽커 활성화 
function updateDatepicker(){
    document.querySelectorAll('.datepicker-icon').forEach(datepicker => {
        initializeLitepicker(datepicker);
    });
}

//동적으로 생성된 time mask 활성화
function updateTimeMask(){
    var inputTimes = document.getElementsByClassName('input-time');
    for (var i = 0; i < inputTimes.length; i++) {
        initializeInputMask(inputTimes[i]);
    }
}

//동적으로 생성된 input tel 활성화
function updateTimeMask(){
    var inputTimes = document.getElementsByClassName('input-time');
    for (var i = 0; i < inputTimes.length; i++) {
        initializeInputMask(inputTimes[i]);
    }
}

//순서 변경
function indexMoveInput(button) {
    const inputGroup = button.closest('.input-group');
    const input = inputGroup.querySelector('input[type="tel"]');
    const value = parseInt(input.value);
    if (isNaN(value) || value < 1) {
        alert('유효한 순서 번호를 입력해주세요.');
        return;
    }

    const table = document.querySelector('.table-responsive table tbody');
    const rows = Array.from(table.querySelectorAll('tr'));

    if (value > rows.length) {
        alert('입력한 순서가 총 행의 수를 초과합니다.');
        return;
    }

    const checkedRows = rows.filter(row => row.querySelector('input[type="checkbox"]:checked'));
    if (checkedRows.length === 0) {
        alert('이동할 항목을 선택해주세요.');
        return;
    }
    if(value == rows.length){
        checkedRows.forEach(row => {
            table.insertBefore(row, rows[rows.length]);
        });
    }else{
        checkedRows.forEach(row => {
            table.insertBefore(row, rows[value - 1]);
        });
    }
    
    // 인덱스 번호 재정렬
    updateIndex()
}
function indexMoveInput(button) {
    const inputGroup = button.closest('.input-group');
    const input = inputGroup.querySelector('input[type="tel"]');
    const value = parseInt(input.value);
    if (isNaN(value) || value < 1) {
        alert('유효한 순서 번호를 입력해주세요.');
        return;
    }

    const table = button.closest('.card').querySelector('.table-responsive table tbody');
    const rows = Array.from(table.querySelectorAll('tr'));

    if (value > rows.length) {
        alert('입력한 순서가 총 행의 수를 초과합니다.');
        return;
    }

    const checkedRows = rows.filter(row => row.querySelector('input[type="checkbox"]:checked'));
    if (checkedRows.length === 0) {
        alert('이동할 항목을 선택해주세요.');
        return;
    }
    if(value == rows.length){
        checkedRows.forEach(row => {
            table.insertBefore(row, rows[rows.length]);
        });
    }else{
        checkedRows.forEach(row => {
            table.insertBefore(row, rows[value - 1]);
        });
    }
    
    // 인덱스 번호 재정렬
    updateIndex()
}

//일괄 추가할인
function extractNumber(str) {
    return parseInt(str.replace(/[^\d]/g, ''), 10);
}
function addDiscount(button){
    const discountValue = button.closest('.input-group').querySelector('input').value;
    if(discountValue > 100 || discountValue < 0){
        alert('0이상 100이하의 값을 넣어주세요.');
        return false;
    }
    button.closest('.card').querySelectorAll('tbody tr').forEach(function(row){
        const priceValue = extractNumber(row.querySelector('.price').textContent);
        const discountInput = row.querySelector('.discount');

        
        discountInput.value = priceValue * discountValue / 100
    });
}

//일괄 순서변경
// 일괄 순서변경
function listSort(button) {
    const table = button.closest('.card').querySelector('.right_table_body');
    const changeValue = button.closest('.input-group').querySelector('.input-group select').value;
    const rows = Array.from(table.querySelectorAll('tr'));

    function sortRows(sortFunction) {
        rows.sort(sortFunction);
        rows.forEach((row, index) => {
            table.appendChild(row);
        });
    }

    switch (changeValue) {
        case '1': // 신규상품순
            sortRows((a, b) => {
                const dateA = new Date(a.dataset.dateTime);
                const dateB = new Date(b.dataset.dateTime);
                return dateB - dateA;
            });
            break;
        case '2': // 최근수정상품순
            sortRows((a, b) => {
                const dateA = new Date(a.dataset.modifyDateTime);
                const dateB = new Date(b.dataset.modifyDateTime);
                return dateB - dateA;
            });
            break;
        case '3': // 낮은 가격순
            sortRows((a, b) => {
                const priceA = parseInt(a.querySelector('.price').textContent.replace(/[^\d]/g, ''));
                const priceB = parseInt(b.querySelector('.price').textContent.replace(/[^\d]/g, ''));
                return priceA - priceB;
            });
            break;
        case '4': // 높은 가격순
            sortRows((a, b) => {
                const priceA = parseInt(a.querySelector('.price').textContent.replace(/[^\d]/g, ''));
                const priceB = parseInt(b.querySelector('.price').textContent.replace(/[^\d]/g, ''));
                return priceB - priceA;
            });
            break;
        case '5': // 가나다순
            sortRows((a, b) => {
                const nameA = a.querySelector('.prd_name').textContent.trim();
                const nameB = b.querySelector('.prd_name').textContent.trim();
                return nameA.localeCompare(nameB, 'ko-KR');
            });
            break;
    }

    // 인덱스 번호 재정렬
    updateIndex()
}
</script>
<script src="/resources/static/dist/js/tabler.min.js"></script>
</body>
</html>